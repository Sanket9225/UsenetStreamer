<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UsenetStreamer Control Panel</title>
  <link rel="icon" href="/assets/icon.png" type="image/png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header>
      <h1>UsenetStreamer Control Panel</h1>
      <p class="subtitle">Configure addon credentials, NNTP triage settings, and grab the manifest URL without editing environment files by hand.</p>
    </header>

    <section class="card">
      <h2>Authentication</h2>
      <p class="hint">Enter the change token (the same one embedded in your manifest). Use this only if you think the addon URL is exposed to the world.</p>
      <p class="warning">Treat this token like a password. If someone has both the token and the public addon URL, they can open the admin panel and view or modify your credentials.</p>
      <div class="field-row">
        <label for="tokenInput">Change Token</label>
        <input id="tokenInput" type="password" autocomplete="off" />
      </div>
      <button id="loadConfig" class="primary">Load Configuration</button>
      <p id="authError" class="error hidden"></p>
    </section>

    <section class="card hidden" id="configSection">
      <form id="configForm">
        <section class="group">
          <h3>Indexer Manager</h3>
          <div class="field-grid">
            <label>Manager Type
              <select name="INDEXER_MANAGER">
                <option value="prowlarr">Prowlarr</option>
                <option value="nzbhydra">NZBHydra</option>
              </select>
            </label>
            <label>Manager URL
              <input name="INDEXER_MANAGER_URL" type="url" placeholder="http://localhost:9696" />
            </label>
            <label>API Key
              <input name="INDEXER_MANAGER_API_KEY" type="password" autocomplete="new-password" />
            </label>
            <label>Indexer IDs / Names
              <input name="INDEXER_MANAGER_INDEXERS" type="text" placeholder="-1 or sci-fi,4k" />
              <span class="field-hint">Comma-separated list of indexers this addon may query. Prowlarr: numeric IDs, with -1 meaning “all Usenet indexers”. NZBHydra: type the indexer names exactly as shown in Hydra.</span>
            </label>
            <label>Paid Indexers (comma separated)
              <input name="NZB_TRIAGE_PRIORITY_INDEXERS" type="text" placeholder="9,33" />
              <span class="field-hint">Subset of the above list that gets used for health checks. Must be a comma-separated subset of “Indexer IDs / Names”.</span>
            </label>
            <label class="checkbox">
              <input name="INDEXER_MANAGER_STRICT_ID_MATCH" type="checkbox" />
              <span>Strict ID Matching Only</span>
              <span class="field-hint">Faster ID-only searches; indexers that rely on text queries will be skipped.</span>
            </label>
          </div>
          <div class="inline-actions">
            <button type="button" class="secondary" data-test="indexer">Test Connection</button>
            <span class="status-message" data-test-status="indexer"></span>
          </div>
        </section>

        <section class="group">
          <h3>Direct Newznab Indexers (Optional)</h3>
          <div class="field-grid">
            <label class="checkbox">
              <input name="NEWZNAB_ENABLED" type="checkbox" />
              <span>Enable Direct Newznab Queries</span>
              <span class="field-hint">Queries these endpoints alongside the indexer manager. Leave off if you rely solely on Prowlarr/NZBHydra.</span>
            </label>
            <div id="newznab-indexers-list">
              <!-- Dynamic rows will be inserted here -->
            </div>
            <button type="button" id="addNewznabIndexer" class="secondary">Add Indexer</button>
            <label class="checkbox">
              <input name="NEWZNAB_FILTER_NZB_ONLY" type="checkbox" />
              <span>Filter to NZB URLs Only</span>
              <span class="field-hint">Keeps only results whose download links end with .nzb (recommended to reduce noise).</span>
            </label>
          </div>
          <div class="inline-actions">
            <button type="button" class="secondary" data-test="newznab">Test Connection</button>
            <span class="status-message" data-test-status="newznab"></span>
          </div>
        </section>

        <section class="group">
          <h3>Result Sorting &amp; Filters</h3>
          <div class="field-grid">
            <label>Sorting Mode
              <select name="NZB_SORT_MODE">
                <option value="quality_then_size">Quality → Size</option>
                <option value="language_quality_size">Preferred Language → Quality → Size</option>
              </select>
              <span class="field-hint">Choose how releases are prioritized before NZB health checks run.</span>
            </label>
            <label>Preferred Language
              <select name="NZB_PREFERRED_LANGUAGE" data-sorting-language>
                <option value="">No preference</option>
                <option value="English">English</option>
                <option value="Tamil">Tamil</option>
                <option value="Hindi">Hindi</option>
                <option value="Malayalam">Malayalam</option>
                <option value="Kannada">Kannada</option>
                <option value="Telugu">Telugu</option>
                <option value="Chinese">Chinese</option>
                <option value="Russian">Russian</option>
                <option value="Arabic">Arabic</option>
                <option value="Japanese">Japanese</option>
                <option value="Korean">Korean</option>
                <option value="Taiwanese">Taiwanese</option>
                <option value="Latino">Latino</option>
                <option value="French">French</option>
                <option value="Spanish">Spanish</option>
                <option value="Portuguese">Portuguese</option>
                <option value="Italian">Italian</option>
                <option value="German">German</option>
                <option value="Ukrainian">Ukrainian</option>
                <option value="Polish">Polish</option>
                <option value="Czech">Czech</option>
                <option value="Thai">Thai</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Dutch">Dutch</option>
                <option value="Bengali">Bengali</option>
                <option value="Turkish">Turkish</option>
                <option value="Greek">Greek</option>
                <option value="Swedish">Swedish</option>
                <option value="Romanian">Romanian</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Finnish">Finnish</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Danish">Danish</option>
                <option value="Hebrew">Hebrew</option>
                <option value="Lithuanian">Lithuanian</option>
                <option value="Punjabi">Punjabi</option>
                <option value="Marathi">Marathi</option>
                <option value="Gujarati">Gujarati</option>
                <option value="Bhojpuri">Bhojpuri</option>
                <option value="Nepali">Nepali</option>
                <option value="Urdu">Urdu</option>
                <option value="Tagalog">Tagalog</option>
                <option value="Filipino">Filipino</option>
                <option value="Malay">Malay</option>
                <option value="Mongolian">Mongolian</option>
                <option value="Armenian">Armenian</option>
                <option value="Georgian">Georgian</option>
              </select>
              <span class="field-hint">Required only when using the language-first sorting mode.</span>
            </label>
            <label>Max File Size (GB)
              <input name="NZB_MAX_RESULT_SIZE_GB" type="number" min="0" step="0.1" placeholder="30" />
              <span class="field-hint">Defaults to 30 GB. Set 0 for no cap; larger releases are skipped before health checks.</span>
            </label>
          </div>
        </section>

        <section class="group">
          <h3>NZBDav Connection</h3>
          <div class="field-grid">
            <label>NZBDav URL
              <input name="NZBDAV_URL" type="url" placeholder="http://localhost:3000" />
            </label>
            <label>NZBDav API Key
              <input name="NZBDAV_API_KEY" type="password" autocomplete="new-password" />
            </label>
            <label>WebDAV URL
              <input name="NZBDAV_WEBDAV_URL" type="url" placeholder="http://localhost:3000" />
            </label>
            <label>WebDAV User
              <input name="NZBDAV_WEBDAV_USER" type="text" />
            </label>
            <label>WebDAV Password
              <input name="NZBDAV_WEBDAV_PASS" type="password" autocomplete="new-password" />
            </label>
            <label>Base Category
              <input name="NZBDAV_CATEGORY" type="text" placeholder="Stremio" />
            </label>
            <label>Movies Category
              <input name="NZBDAV_CATEGORY_MOVIES" type="text" placeholder="Movies" />
            </label>
            <label>Series Category
              <input name="NZBDAV_CATEGORY_SERIES" type="text" placeholder="Tv" />
            </label>
          </div>
          <div class="inline-actions">
            <button type="button" class="secondary" data-test="nzbdav">Test Connection</button>
            <span class="status-message" data-test-status="nzbdav"></span>
          </div>
        </section>

        <section class="group">
          <h3>NZB Health Check</h3>
          <div class="field-grid">
            <label class="checkbox">
              <input name="NZB_TRIAGE_ENABLED" type="checkbox" />
              <span>Enable NZB Health Checks</span>
            </label>
            <label>Usenet Provider Host
              <input name="NZB_TRIAGE_NNTP_HOST" type="text" placeholder="news.easynews.com" data-health-required="true" />
            </label>
            <label>Usenet Provider Port
              <input name="NZB_TRIAGE_NNTP_PORT" type="number" min="1" placeholder="563" data-health-required="true" />
            </label>
            <label class="checkbox">
              <input name="NZB_TRIAGE_NNTP_TLS" type="checkbox" />
              <span>Use TLS</span>
            </label>
            <label>Usenet Provider Username
              <input name="NZB_TRIAGE_NNTP_USER" type="text" autocomplete="off" data-health-required="true" />
            </label>
            <label>Usenet Provider Password
              <input name="NZB_TRIAGE_NNTP_PASS" type="password" autocomplete="new-password" data-health-required="true" />
            </label>
            <label>Number of NZBs to Inspect
              <select name="NZB_TRIAGE_MAX_CANDIDATES" data-health-required="true">
                <option value="2">2</option>
                <option value="4">4</option>
                <option value="6">6</option>
              </select>
              <span class="field-hint">Pick 2 for the fastest responses, 4 or 6 to probe more candidates.</span>
            </label>
            <label>Max Usenet Connections
              <input name="NZB_TRIAGE_MAX_CONNECTIONS" type="number" min="1" step="1" data-health-required="true" />
              <span class="field-hint">Keep this ≤ 2 × “Number of NZBs to Inspect”, and ensure the combined total of these connections plus any NZBDav connections stays within your provider’s max.</span>
            </label>
          </div>
          <div class="inline-actions">
            <button type="button" class="secondary" data-test="usenet">Test Connection</button>
            <span class="status-message" data-test-status="usenet"></span>
          </div>
        </section>

        <section class="group">
          <h3>Addon Metadata</h3>
          <div class="field-grid">
            <label>Public Base URL
              <input name="ADDON_BASE_URL" type="url" placeholder="https://example.com" />
            </label>
            <label>Change Token
              <input name="ADDON_SHARED_SECRET" type="password" autocomplete="new-password" />
              <span class="field-hint">Use this if you believe the addon URL is exposed to the world.</span>
            </label>
          </div>
        </section>

        <div class="actions">
          <button type="submit" class="primary">Save &amp; Restart</button>
          <span id="saveStatus" class="status-message"></span>
        </div>
      </form>

      <div class="manifest-row">
        <div>
          <strong>Manifest URL</strong>
          <p id="manifestDescription" class="hint">Add this URL to Stremio once HTTPS and token are set.</p>
        </div>
        <div class="manifest-link">
          <a id="manifestLink" href="#" target="_blank" rel="noopener">Not configured</a>
          <button type="button" id="copyManifest" class="icon-button" aria-label="Copy manifest URL" disabled>
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M8 3h9a2 2 0 0 1 2 2v11h-2V5H8V3zm-3 4h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2zm0 2v10h9V9H5z" />
            </svg>
          </button>
          <span id="copyManifestStatus" class="copy-status" aria-live="polite"></span>
        </div>
      </div>

      <p class="support-note">If you like this addon, please consider <a href="https://buymeacoffee.com/gaikwadsank" target="_blank" rel="noopener">buying me a coffee</a>.</p>
    </section>
  </main>
  <script src="app.js"></script>
</body>
</html>
